<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - SocialConnect</title>
    <meta name="description" content="Create a new password for your SocialConnect account. Enter your new password and confirm it to complete the reset process.">
    <link rel="stylesheet" href="../css/generic.css">
    <link rel="stylesheet" href="../css/reset_password.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="navbar container">
            <a href="welcome.html" class="logo">SocialConnect</a>
            <ul class="nav-menu">
                <li><a href="welcome.html" class="nav-link">Home</a></li>
                <li><a href="login.html" class="nav-link">Sign In</a></li>
                <li><a href="register.html" class="btn btn-primary">Register</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
        </nav>
    </header>

    <main class="auth-main">
        <div class="container">
            <div class="reset-password-container">
                <!-- Main Content -->
                <div class="reset-password-content">
                    <!-- Valid Token - Reset Form -->
                    <div class="reset-step active" id="step-reset">
                        <div class="reset-header">
                            <div class="reset-icon">üîë</div>
                            <h1>Create new password</h1>
                            <p>Your new password must be different from your previous password and meet our security requirements.</p>
                        </div>

                        <form class="reset-form" id="resetPasswordForm" novalidate>
                            <!-- Token (hidden) -->
                            <input type="hidden" id="resetToken" name="token" value="">
                            
                            <div class="form-group">
                                <label for="newPassword" class="form-label">New password *</label>
                                <div class="password-input-wrapper">
                                    <input 
                                        type="password" 
                                        id="newPassword" 
                                        name="newPassword" 
                                        class="form-input" 
                                        placeholder="Enter your new password"
                                        required
                                        minlength="8"
                                        aria-describedby="newPassword-error newPassword-help"
                                    >
                                    <button type="button" class="password-toggle" aria-label="Toggle password visibility">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <div class="form-help" id="newPassword-help">At least 8 characters with a mix of letters, numbers, and symbols</div>
                                <div class="form-error" id="newPassword-error" role="alert"></div>
                                
                                <!-- Password Strength Indicator -->
                                <div class="password-strength" id="password-strength">
                                    <div class="strength-bar">
                                        <div class="strength-fill"></div>
                                    </div>
                                    <span class="strength-text">Password strength</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword" class="form-label">Confirm new password *</label>
                                <div class="password-input-wrapper">
                                    <input 
                                        type="password" 
                                        id="confirmPassword" 
                                        name="confirmPassword" 
                                        class="form-input" 
                                        placeholder="Confirm your new password"
                                        required
                                        aria-describedby="confirmPassword-error"
                                    >
                                    <button type="button" class="password-toggle" aria-label="Toggle password visibility">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <div class="form-error" id="confirmPassword-error" role="alert"></div>
                            </div>

                            <!-- Password Requirements -->
                            <div class="password-requirements">
                                <h4>Password requirements:</h4>
                                <ul class="requirements-list">
                                    <li class="requirement" data-requirement="length">
                                        <span class="requirement-icon">‚úó</span>
                                        At least 8 characters long
                                    </li>
                                    <li class="requirement" data-requirement="lowercase">
                                        <span class="requirement-icon">‚úó</span>
                                        One lowercase letter
                                    </li>
                                    <li class="requirement" data-requirement="uppercase">
                                        <span class="requirement-icon">‚úó</span>
                                        One uppercase letter
                                    </li>
                                    <li class="requirement" data-requirement="number">
                                        <span class="requirement-icon">‚úó</span>
                                        One number
                                    </li>
                                    <li class="requirement" data-requirement="symbol">
                                        <span class="requirement-icon">‚úó</span>
                                        One special character
                                    </li>
                                </ul>
                            </div>

                            <button type="submit" class="btn btn-primary btn-full btn-lg" id="resetBtn">
                                <span class="btn-text">Update Password</span>
                                <span class="spinner hidden"></span>
                            </button>
                        </form>
                    </div>

                    <!-- Success State -->
                    <div class="reset-step" id="step-success">
                        <div class="reset-header">
                            <div class="reset-icon success">‚úÖ</div>
                            <h1>Password updated successfully!</h1>
                            <p>Your password has been updated. You can now sign in with your new password.</p>
                        </div>

                        <div class="reset-actions">
                            <a href="login.html" class="btn btn-primary btn-full btn-lg">
                                Continue to Sign In
                            </a>
                        </div>

                        <div class="reset-footer">
                            <p>Having trouble? <a href="help-support.html">Contact support</a></p>
                        </div>
                    </div>

                    <!-- Invalid/Expired Token -->
                    <div class="reset-step" id="step-invalid">
                        <div class="reset-header">
                            <div class="reset-icon error">‚ùå</div>
                            <h1>Reset link expired</h1>
                            <p>This password reset link has expired or is invalid. Please request a new password reset link.</p>
                        </div>

                        <div class="reset-actions">
                            <a href="forgot-password.html" class="btn btn-primary btn-full btn-lg">
                                Request New Reset Link
                            </a>
                        </div>

                        <div class="reset-footer">
                            <p>Already have an account? <a href="login.html">Sign in instead</a></p>
                        </div>
                    </div>

                    <!-- Error State -->
                    <div class="reset-step" id="step-error">
                        <div class="reset-header">
                            <div class="reset-icon error">‚ö†Ô∏è</div>
                            <h1>Something went wrong</h1>
                            <p id="error-message">We encountered an error while resetting your password. Please try again.</p>
                        </div>

                        <div class="reset-actions">
                            <button type="button" class="btn btn-primary btn-full btn-lg" id="retryBtn">
                                Try Again
                            </button>
                            <a href="forgot-password.html" class="btn btn-outline btn-full">
                                Request New Reset Link
                            </a>
                        </div>

                        <div class="reset-footer">
                            <p>Need help? <a href="help-support.html">Contact support</a></p>
                        </div>
                    </div>
                </div>

                <!-- Security Notice -->
                <div class="security-notice">
                    <div class="notice-icon">üõ°Ô∏è</div>
                    <div class="notice-content">
                        <h4>Security Notice</h4>
                        <p>For your security, password reset links expire after 24 hours. Your new password will be required for all future sign-ins across all devices.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Password validation functions
        function checkPasswordStrength(password) {
            let strength = 0;
            const checks = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                numbers: /\d/.test(password),
                symbols: /[^A-Za-z0-9]/.test(password)
            };

            strength = Object.values(checks).filter(Boolean).length;

            // Update requirement indicators
            updateRequirements(checks);

            if (strength < 2) return 'weak';
            if (strength < 3) return 'fair';
            if (strength < 4) return 'good';
            return 'strong';
        }

        function updateRequirements(checks) {
            const requirements = {
                length: document.querySelector('[data-requirement="length"]'),
                lowercase: document.querySelector('[data-requirement="lowercase"]'),
                uppercase: document.querySelector('[data-requirement="uppercase"]'),
                number: document.querySelector('[data-requirement="number"]'),
                symbol: document.querySelector('[data-requirement="symbol"]')
            };

            Object.entries(checks).forEach(([key, valid]) => {
                const element = requirements[key === 'numbers' ? 'number' : key === 'symbols' ? 'symbol' : key];
                if (element) {
                    const icon = element.querySelector('.requirement-icon');
                    if (valid) {
                        element.classList.add('valid');
                        icon.textContent = '‚úì';
                    } else {
                        element.classList.remove('valid');
                        icon.textContent = '‚úó';
                    }
                }
            });
        }

        // Password strength indicator
        const newPasswordInput = document.getElementById('newPassword');
        if (newPasswordInput) {
            newPasswordInput.addEventListener('input', function() {
                const password = this.value;
                const strengthFill = document.querySelector('.strength-fill');
                const strengthText = document.querySelector('.strength-text');
                
                if (password.length === 0) {
                    strengthFill.className = 'strength-fill';
                    strengthText.textContent = 'Password strength';
                    // Reset all requirements
                    document.querySelectorAll('.requirement').forEach(req => {
                        req.classList.remove('valid');
                        req.querySelector('.requirement-icon').textContent = '‚úó';
                    });
                    return;
                }

                const strength = checkPasswordStrength(password);
                strengthFill.className = `strength-fill ${strength}`;
                strengthText.textContent = `Password strength: ${strength.charAt(0).toUpperCase() + strength.slice(1)}`;
            });
        }

        // Password confirmation validation
        const confirmPasswordInput = document.getElementById('confirmPassword');
        if (confirmPasswordInput) {
            confirmPasswordInput.addEventListener('input', function() {
                const password = document.getElementById('newPassword').value;
                const confirmPassword = this.value;
                const errorElement = document.getElementById('confirmPassword-error');

                if (confirmPassword && password !== confirmPassword) {
                    errorElement.textContent = 'Passwords do not match.';
                    this.classList.add('invalid');
                    this.classList.remove('valid');
                } else if (confirmPassword) {
                    errorElement.textContent = '';
                    this.classList.add('valid');
                    this.classList.remove('invalid');
                }
            });
        }

        // Password toggle functionality
        document.querySelectorAll('.password-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const passwordInput = this.parentElement.querySelector('input');
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            });
        });

        // Form submission
        const resetForm = document.getElementById('resetPasswordForm');
        if (resetForm) {
            resetForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const resetBtn = document.getElementById('resetBtn');
                const btnText = resetBtn.querySelector('.btn-text');
                const spinner = resetBtn.querySelector('.spinner');

                // Basic validation
                if (!password || !confirmPassword) {
                    showError('Please fill in all required fields.');
                    return;
                }

                if (password !== confirmPassword) {
                    showError('Passwords do not match.');
                    return;
                }

                if (checkPasswordStrength(password) === 'weak') {
                    showError('Please choose a stronger password.');
                    return;
                }

                // Show loading state
                resetBtn.disabled = true;
                btnText.textContent = 'Updating...';
                spinner.classList.remove('hidden');

                // Simulate API call (replace with actual implementation)
                setTimeout(() => {
                    // Reset loading state
                    resetBtn.disabled = false;
                    btnText.textContent = 'Update Password';
                    spinner.classList.add('hidden');

                    // Show success step
                    showStep('step-success');
                }, 2000);
            });
        }

        // Retry functionality
        const retryBtn = document.getElementById('retryBtn');
        if (retryBtn) {
            retryBtn.addEventListener('click', function() {
                showStep('step-reset');
            });
        }

        // Utility functions
        function showStep(stepId) {
            document.querySelectorAll('.reset-step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
        }

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            if (errorElement) {
                errorElement.textContent = message;
            }
            showStep('step-error');
        }

        // Mobile navigation toggle
        const navToggle = document.querySelector('.nav-toggle');
        const navMenu = document.querySelector('.nav-menu');
        if (navToggle && navMenu) {
            navToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
        }

        // URL parameter handling (for token validation)
        function getURLParameter(name) {
            return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
        }

        // Initialize page based on URL parameters
        window.addEventListener('DOMContentLoaded', function() {
            const token = getURLParameter('token');
            const tokenInput = document.getElementById('resetToken');
            
            if (token && tokenInput) {
                tokenInput.value = token;
                // In a real application, validate the token here
                showStep('step-reset');
            } else {
                // No token or invalid token
                showStep('step-invalid');
            }
        });
    </script>
</body>
</html>