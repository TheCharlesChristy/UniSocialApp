<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Media - SocialConnect</title>
    <link rel="stylesheet" href="../css/generic.css">
    <link rel="stylesheet" href="../css/select-media.css">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="nav-left">
                <a href="main-feed.html" class="logo">
                    <span class="logo-icon">üì±</span>
                    SocialConnect
                </a>
            </div>

            <div class="nav-center">
                <div class="search-box">
                    <input type="text" placeholder="Search SocialConnect..." aria-label="Search">
                    <button class="search-btn" aria-label="Search">üîç</button>
                </div>
            </div>

            <div class="nav-right">
                <button class="nav-btn" aria-label="Notifications">
                    <span class="nav-icon">üîî</span>
                    <span class="badge">3</span>
                </button>
                <button class="nav-btn" aria-label="Messages">
                    <span class="nav-icon">üí¨</span>
                    <span class="badge">2</span>
                </button>
                <div class="user-dropdown">
                    <button class="user-btn" aria-label="User menu">
                        <img src="../../backend/media/images/placeholder.png" alt="Profile" class="user-avatar">
                    </button>
                    <div class="dropdown-menu">
                        <a href="user-profile.html" class="dropdown-item">
                            <span class="dropdown-icon">üë§</span>
                            My Profile
                        </a>
                        <a href="privacy-settings.html" class="dropdown-item">
                            <span class="dropdown-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="login.html" class="dropdown-item">
                            <span class="dropdown-icon">üö™</span>
                            Logout
                        </a>
                    </div>
                </div>
                <button class="mobile-toggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <div class="header-content">
                    <h1>Select Media</h1>
                    <p>Choose photos and videos to share with your post</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="history.back()">Cancel</button>
                    <button class="btn btn-primary" id="confirmSelection" disabled>Add Selected</button>
                </div>
            </div>

            <div class="media-selection-container">
                <!-- Media Upload Section -->
                <div class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">üìé</div>
                            <h3>Upload New Media</h3>
                            <p>Drag and drop files here or click to browse</p>
                            <button class="btn btn-outline" id="browseFiles">Browse Files</button>
                        </div>
                        <input type="file" id="fileInput" multiple accept="image/*,video/*" hidden>
                    </div>
                    
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">Uploading... 0%</span>
                    </div>
                </div>

                <!-- Media Filters -->
                <div class="media-filters">
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-filter="all">All Media</button>
                        <button class="filter-tab" data-filter="photos">Photos</button>
                        <button class="filter-tab" data-filter="videos">Videos</button>
                        <button class="filter-tab" data-filter="recent">Recent</button>
                    </div>

                    <div class="filter-options">
                        <div class="view-options">
                            <button class="view-btn active" data-view="grid" aria-label="Grid view">‚äû</button>
                            <button class="view-btn" data-view="list" aria-label="List view">‚ò∞</button>
                        </div>
                        
                        <div class="sort-dropdown">
                            <select id="sortSelect">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="name">Name A-Z</option>
                                <option value="size">Size</option>
                            </select>
                        </div>

                        <div class="search-media">
                            <input type="text" placeholder="Search media..." id="mediaSearch">
                        </div>
                    </div>
                </div>

                <!-- Selection Info -->
                <div class="selection-info" id="selectionInfo" style="display: none;">
                    <div class="selection-count">
                        <span id="selectedCount">0</span> items selected
                    </div>
                    <div class="selection-actions">
                        <button class="btn btn-sm btn-outline" id="selectAll">Select All</button>
                        <button class="btn btn-sm btn-outline" id="clearSelection">Clear Selection</button>
                    </div>
                </div>

                <!-- Media Grid -->
                <div class="media-grid" id="mediaGrid">
                    <!-- Sample media items -->
                    <div class="media-item" data-type="photo" data-name="vacation-sunset.jpg" data-date="2024-01-15">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media1">
                            <label for="media1"></label>
                        </div>
                        <div class="media-preview">
                            <img src="../../backend/media/images/placeholder.png" alt="Vacation sunset">
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">vacation-sunset.jpg</div>
                            <div class="media-details">
                                <span class="media-size">2.3 MB</span>
                                <span class="media-date">Jan 15, 2024</span>
                            </div>
                        </div>
                    </div>

                    <div class="media-item" data-type="video" data-name="birthday-party.mp4" data-date="2024-01-10">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media2">
                            <label for="media2"></label>
                        </div>
                        <div class="media-preview">
                            <video>
                                <source src="../../backend/media/videos/placeholder.mp4" type="video/mp4">
                            </video>
                            <div class="video-duration">2:34</div>
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">‚ñ∂Ô∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">birthday-party.mp4</div>
                            <div class="media-details">
                                <span class="media-size">15.7 MB</span>
                                <span class="media-date">Jan 10, 2024</span>
                            </div>
                        </div>
                    </div>

                    <div class="media-item" data-type="photo" data-name="family-dinner.jpg" data-date="2024-01-08">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media3">
                            <label for="media3"></label>
                        </div>
                        <div class="media-preview">
                            <img src="../../backend/media/images/placeholder.png" alt="Family dinner">
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">family-dinner.jpg</div>
                            <div class="media-details">
                                <span class="media-size">1.8 MB</span>
                                <span class="media-date">Jan 8, 2024</span>
                            </div>
                        </div>
                    </div>

                    <div class="media-item" data-type="photo" data-name="weekend-hike.jpg" data-date="2024-01-05">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media4">
                            <label for="media4"></label>
                        </div>
                        <div class="media-preview">
                            <img src="../../backend/media/images/placeholder.png" alt="Weekend hike">
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">weekend-hike.jpg</div>
                            <div class="media-details">
                                <span class="media-size">3.1 MB</span>
                                <span class="media-date">Jan 5, 2024</span>
                            </div>
                        </div>
                    </div>

                    <div class="media-item" data-type="video" data-name="cooking-tutorial.mp4" data-date="2024-01-03">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media5">
                            <label for="media5"></label>
                        </div>
                        <div class="media-preview">
                            <video>
                                <source src="../../backend/media/videos/placeholder.mp4" type="video/mp4">
                            </video>
                            <div class="video-duration">5:12</div>
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">‚ñ∂Ô∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">cooking-tutorial.mp4</div>
                            <div class="media-details">
                                <span class="media-size">28.4 MB</span>
                                <span class="media-date">Jan 3, 2024</span>
                            </div>
                        </div>
                    </div>

                    <div class="media-item" data-type="photo" data-name="coffee-morning.jpg" data-date="2024-01-01">
                        <div class="media-checkbox">
                            <input type="checkbox" id="media6">
                            <label for="media6"></label>
                        </div>
                        <div class="media-preview">
                            <img src="../../backend/media/images/placeholder.png" alt="Coffee morning">
                            <div class="media-overlay">
                                <button class="preview-btn" aria-label="Preview">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="media-info">
                            <div class="media-name">coffee-morning.jpg</div>
                            <div class="media-details">
                                <span class="media-size">1.2 MB</span>
                                <span class="media-date">Jan 1, 2024</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Load More -->
                <div class="load-more-section">
                    <button class="btn btn-outline" id="loadMore">Load More Media</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Media Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-overlay"></div>
        <div class="modal-content media-preview-modal">
            <div class="modal-header">
                <h3 id="previewTitle">Media Preview</h3>
                <button class="modal-close" id="closePreview">&times;</button>
            </div>
            <div class="modal-body">
                <div class="preview-container" id="previewContainer">
                    <!-- Media content will be loaded here -->
                </div>
                <div class="preview-info">
                    <div class="preview-details" id="previewDetails">
                        <!-- Media details will be shown here -->
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-outline" id="downloadMedia">Download</button>
                        <button class="btn btn-primary" id="selectFromPreview">Select This Media</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const browseFiles = document.getElementById('browseFiles');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const filterTabs = document.querySelectorAll('.filter-tab');
        const viewBtns = document.querySelectorAll('.view-btn');
        const mediaGrid = document.getElementById('mediaGrid');
        const selectionInfo = document.getElementById('selectionInfo');
        const selectedCount = document.getElementById('selectedCount');
        const confirmSelection = document.getElementById('confirmSelection');
        const selectAll = document.getElementById('selectAll');
        const clearSelection = document.getElementById('clearSelection');
        const mediaSearch = document.getElementById('mediaSearch');
        const sortSelect = document.getElementById('sortSelect');
        const previewModal = document.getElementById('previewModal');
        const closePreview = document.getElementById('closePreview');
        const previewContainer = document.getElementById('previewContainer');

        let selectedMedia = new Set();

        // File Upload Handling
        browseFiles.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            handleFileUpload(files);
        });
        
        fileInput.addEventListener('change', (e) => {
            handleFileUpload(e.target.files);
        });

        function handleFileUpload(files) {
            if (files.length === 0) return;
            
            uploadProgress.style.display = 'block';
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        addUploadedFiles(files);
                    }, 500);
                }
                
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `Uploading... ${Math.round(progress)}%`;
            }, 200);
        }

        function addUploadedFiles(files) {
            Array.from(files).forEach((file, index) => {
                const mediaItem = createMediaItem(file, index);
                mediaGrid.insertBefore(mediaItem, mediaGrid.firstChild);
            });
        }

        function createMediaItem(file, index) {
            const div = document.createElement('div');
            const isVideo = file.type.startsWith('video/');
            const id = `uploaded-${Date.now()}-${index}`;
            
            div.className = 'media-item';
            div.setAttribute('data-type', isVideo ? 'video' : 'photo');
            div.setAttribute('data-name', file.name);
            div.setAttribute('data-date', new Date().toISOString().split('T')[0]);
            
            div.innerHTML = `
                <div class="media-checkbox">
                    <input type="checkbox" id="${id}">
                    <label for="${id}"></label>
                </div>
                <div class="media-preview">
                    ${isVideo 
                        ? `<video><source src="${URL.createObjectURL(file)}" type="${file.type}"></video><div class="video-duration">--:--</div>`
                        : `<img src="${URL.createObjectURL(file)}" alt="${file.name}">`
                    }
                    <div class="media-overlay">
                        <button class="preview-btn" aria-label="Preview">${isVideo ? '‚ñ∂Ô∏è' : 'üëÅÔ∏è'}</button>
                    </div>
                </div>
                <div class="media-info">
                    <div class="media-name">${file.name}</div>
                    <div class="media-details">
                        <span class="media-size">${formatFileSize(file.size)}</span>
                        <span class="media-date">Just uploaded</span>
                    </div>
                </div>
            `;
            
            // Add event listeners
            const checkbox = div.querySelector('input[type="checkbox"]');
            checkbox.addEventListener('change', updateSelection);
            
            const previewBtn = div.querySelector('.preview-btn');
            previewBtn.addEventListener('click', () => showPreview(file, file.name));
            
            return div;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // Filter Handling
        filterTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                filterTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                filterMedia(tab.dataset.filter);
            });
        });

        function filterMedia(filter) {
            const mediaItems = document.querySelectorAll('.media-item');
            mediaItems.forEach(item => {
                const type = item.dataset.type;
                const date = new Date(item.dataset.date);
                const isRecent = (Date.now() - date.getTime()) < (7 * 24 * 60 * 60 * 1000); // 7 days
                
                let show = false;
                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'photos':
                        show = type === 'photo';
                        break;
                    case 'videos':
                        show = type === 'video';
                        break;
                    case 'recent':
                        show = isRecent;
                        break;
                }
                
                item.style.display = show ? 'block' : 'none';
            });
        }

        // View Toggle
        viewBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                viewBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                toggleView(btn.dataset.view);
            });
        });

        function toggleView(view) {
            mediaGrid.className = view === 'list' ? 'media-grid list-view' : 'media-grid';
        }

        // Selection Handling
        function updateSelection() {
            const checkboxes = document.querySelectorAll('.media-item input[type="checkbox"]');
            selectedMedia.clear();
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedMedia.add(checkbox.id);
                }
            });
            
            selectedCount.textContent = selectedMedia.size;
            selectionInfo.style.display = selectedMedia.size > 0 ? 'flex' : 'none';
            confirmSelection.disabled = selectedMedia.size === 0;
        }

        // Add event listeners to existing checkboxes
        document.querySelectorAll('.media-item input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelection);
        });

        // Add event listeners to existing preview buttons
        document.querySelectorAll('.preview-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const mediaItem = e.target.closest('.media-item');
                const name = mediaItem.dataset.name;
                const type = mediaItem.dataset.type;
                const img = mediaItem.querySelector('img, video');
                showPreview(img.src, name, type);
            });
        });

        selectAll.addEventListener('click', () => {
            const visibleCheckboxes = document.querySelectorAll('.media-item:not([style*="display: none"]) input[type="checkbox"]');
            visibleCheckboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelection();
        });

        clearSelection.addEventListener('click', () => {
            document.querySelectorAll('.media-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelection();
        });

        // Search and Sort
        mediaSearch.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.media-item').forEach(item => {
                const name = item.dataset.name.toLowerCase();
                const matches = name.includes(query);
                item.style.display = matches ? 'block' : 'none';
            });
        });

        sortSelect.addEventListener('change', (e) => {
            sortMedia(e.target.value);
        });

        function sortMedia(criteria) {
            const items = Array.from(document.querySelectorAll('.media-item'));
            
            items.sort((a, b) => {
                switch(criteria) {
                    case 'newest':
                        return new Date(b.dataset.date) - new Date(a.dataset.date);
                    case 'oldest':
                        return new Date(a.dataset.date) - new Date(b.dataset.date);
                    case 'name':
                        return a.dataset.name.localeCompare(b.dataset.name);
                    case 'size':
                        const sizeA = a.querySelector('.media-size').textContent;
                        const sizeB = b.querySelector('.media-size').textContent;
                        return parseFloat(sizeB) - parseFloat(sizeA);
                    default:
                        return 0;
                }
            });
            
            items.forEach(item => mediaGrid.appendChild(item));
        }

        // Preview Modal
        function showPreview(src, name, type) {
            document.getElementById('previewTitle').textContent = name;
            
            if (typeof src === 'string') {
                if (type === 'video') {
                    previewContainer.innerHTML = `<video controls><source src="${src}" type="video/mp4"></video>`;
                } else {
                    previewContainer.innerHTML = `<img src="${src}" alt="${name}">`;
                }
            } else {
                // File object
                const url = URL.createObjectURL(src);
                if (src.type.startsWith('video/')) {
                    previewContainer.innerHTML = `<video controls><source src="${url}" type="${src.type}"></video>`;
                } else {
                    previewContainer.innerHTML = `<img src="${url}" alt="${name}">`;
                }
            }
            
            previewModal.classList.add('active');
        }

        closePreview.addEventListener('click', () => {
            previewModal.classList.remove('active');
        });

        previewModal.addEventListener('click', (e) => {
            if (e.target === previewModal || e.target.classList.contains('modal-overlay')) {
                previewModal.classList.remove('active');
            }
        });

        // Confirm Selection
        confirmSelection.addEventListener('click', () => {
            const selectedFiles = Array.from(selectedMedia).map(id => {
                const item = document.querySelector(`#${id}`).closest('.media-item');
                return {
                    id: id,
                    name: item.dataset.name,
                    type: item.dataset.type,
                    element: item
                };
            });
            
            // In a real app, this would pass the selected media back to the parent window/page
            console.log('Selected media:', selectedFiles);
            alert(`Selected ${selectedFiles.length} media file(s). This would normally add them to your post.`);
            
            // Navigate back or close modal
            history.back();
        });

        // Load More
        document.getElementById('loadMore').addEventListener('click', () => {
            // Simulate loading more media
            const button = document.getElementById('loadMore');
            button.textContent = 'Loading...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = 'Load More Media';
                button.disabled = false;
                // In a real app, this would load more media items
            }, 1000);
        });

        // Initialize
        updateSelection();
    </script>
</body>
</html>
